# Краткая справка по API

## 1. Получение API-токена и авторизация

Для отправки любых запросов к API сервиса вам необходимо иметь API-токен.

Для получения API-токена зайдите в панель администратора на страницу "Управление API-токенами" ([ссылка](https://admin.studgram.ru/tokens)).  
На этой странице нажмите кнопку "Новый API-Токен" и скопируйте его из текстового поля.  
Обратите внимание, что посмотреть ключ токена можно только при его создании.

При отправке запросов к API полученный токен нужно вставить в качестве заголовка `API-Token`.

## 2. Учебные заведения

### 2.1 Получение списка учебных заведений

Чтобы получить все учебные заведения, которые есть в сервисе, отправьте `GET` запрос на адрес `https://api.studgram.ru/api/institutions`.
В качестве ответа вам придёт массив следующих JSON-объектов:

```JSON
{
  "id": "Текстовый ID учебного заведения",
  "title": "Полное название учебного заведения",
  "abbreviation": "Аббревиатура названия"
  }
```

Редактировать учебные заведения через API нельзя, это делается только через панель администратора.

### 2.2 Получение списка факультетов учебного заведения

Чтобы получить список всех факультетов учебного заведения, нужно отправить `GET` запрос на адрес `http://api.studgram.ru/api/institutions/{ID_ОРГАНИЗАЦИИ}/faculties`.  
В качестве ответа вам придёт массив следующих JSON-объектов:

```JSON
{
  "id": "Текстовый ID факультета",
  "abbreviation": "Аббревиатура названия факультета",
  "title": "Полное название факультета"
}
```

### 2.3 Получение списка групп факультета

Чтобы получить список всех групп факультета, нужно отправить `GET` запрос на адрес `http://api.studgram.ru/api/institutions/{ID_ОРГАНИЗАЦИИ}/faculties/{ID_ФАКУЛЬТЕТА}/groups`.  
В качестве ответа вам придёт массив следующих JSON-объектов:

```JSON
{
  "id": "Текстовый ID группы",
  "abbreviation": "Аббревиатура названия группы",
  "title": "Полное название группы"
}
```

## 3. Студенты

### 3.1 Регистрация студента в сервисе

Для регистрации студента в сервисе отправьте `POST` запрос на адрес `https://api.studgram.ru/api/students`.  
В качестве тела запроса используется следующий JSON-объект:

```JSON
{
  "fullName": "ФИО", // опционально
  "vkId": 1,         // опционально
  "maxId": 1,        // опционально
  "telegramId": 1    // опционально
}
```

Все поля запроса являются опциональными и необязательными к указанию.  

При регистрации студента вы можете указать его ID в различных мессенджерах (поля `vkId`, `maxId`, `telegramId`). В будущем вы сможете получить студента по его ID в мессенджере.

Обратите внимение, что ID внутри каждого отдельного мессенджера для каждого студента должен быть уникальным. Вы не можете назначить нескольким студентам один и тот же ID.

После успешной регистрации студента вы получите следующий JSON-объект:

```JSON
{
    "id": "Текстовый ID студента",
    "fullName": "ФИО", // опционально
    "vkId": 1,         // опционально
    "maxId": 1,        // опционально
    "telegramId": 1    // опционально
}
```

Обратите внимание, что все поля кроме `id` - опциональны и будут отсутствовать в выдаче, если вы не указали их при регистрации студента.

### 3.2 Обновление данных студента

Для изменения данных существуюещего студента, отправьте `PATCH` запрос на адрес `https://api.studgram.ru/api/students/{ID_СТУДЕНТА}` со следующим JSON-телом.

```JSON
{
  "fullName": "ФИО", // опционально, пустая строка, чтобы удалить
  "vkId": 1,         // опционально, 0, чтобы удалить
  "maxId": 1,        // опционально, 0, чтобы удалить
  "telegramId": 1    // опционально, 0, чтобы удалить
}
```
После успешного изменения данных, вы получите такой же ответ как и при регистрации студента.

### 3.3 Удаление студента

Для удаления студента отправьте `DELETE` запрос на адрес `https://api.studgram.ru/api/students/{ID_СТУДЕНТА}`.

Никакое тело запроса указывать не нужно, при успешном выполнении вы получите пустой ответ со статус-кодом 200.

### 3.4 Получение текущей учебной организации студента

Для получения текущей учебной организации студента нужно выполнить `GET` запрос на адрес `https://api.studgram.ru/api/students/{ID_СТУДЕНТА}/institution`.  
Если студент прикрелпён к какой-либо организации - вы получите информацию о ней в следующем формате:

```JSON
{
  "id": "Текстовый ID учебного заведения",
  "title": "Полное название учебного заведения",
  "abbreviation": "Аббревиатура названия"
  }
```

Если студент не прикреплён ни к какой организации - вы получите `404` статус-код.

### 3.5 Открепление студента

Для открепления студента вам необходимо выполнить `DELETE` запрос на адрес `https://api.studgram.ru/api/students/{ID_СТУДЕНТА}/institution`.  
При успешном выполнении запроса вы открепите студента от текущей учебной организации, факультета и группы.

### 3.6 Прикрепление студента к учебной организации

Для прикрепления студента к учебной организации нужно выполнить `POST` запрос на адрес `https://api.studgram.ru/api/students/{ID_СТУДЕНТА}/institution/{ID_ОРГАНИЗАЦИИ}`.  
После успешного выполнения запроса вы получите информацию об организации, к которой был прикреплён студент.

```JSON
{
  "id": "Текстовый ID учебного заведения",
  "title": "Полное название учебного заведения",
  "abbreviation": "Аббревиатура названия"
  }
```

Обратите внимание, что вы не можете сменить организацию студента методом прикрепления его к другой. Для начала вы должны вручную ОТКРЕПИТЬ студента от той организации, к которой он прикреплён. Об этом в следующем пункте.

### 3.7 Прикрепление студента к факультету

Для прикрепления студента к факультету нужно выполнить `POST` запрос на адрес `https://api.studgram.ru/api/students/{ID_СТУДЕНТА}/faculty/{ID_ФАКУЛЬТЕТА}`.  
После успешного выполнения запроса вы получите информацию о факультете, к которому был прикреплён студент.

```JSON
{
  "id": "Текстовый ID факультета",
  "abbreviation": "Аббревиатура названия факультета",
  "title": "Полное название факультета"
}
```

Обратите внимание, что студент сперва должен быть прикреплён к организации, к которой относится факультет. А для изменения факультета студента - его сперва необходимо открепить.

### 3.8 Прикрепление студента к группе

Для прикрепления студента к группе нужно выполнить `POST` запрос на адрес `https://api.studgram.ru/api/students/{ID_СТУДЕНТА}/group/{ID_ГРУППЫ}`.  
После успешного выполнения запроса вы получите информацию о группе, к которой был прикреплён студент.

```JSON
{
  "id": "Текстовый ID группы",
  "abbreviation": "Аббревиатура названия группы",
  "title": "Полное название группы"
}
```

Обратите внимание, что студент сперва должен быть прикреплён к факультету, к которому относится группа. А для изменения группы студента - его сперва необходимо открепить.

### 3.9 Получение статуса прикреплени студента

После того, как вы прикрепите студента к учебному заведению, факультету и группе, в панели адмнистратора учебного заведния на странице группы, к которой вы прикрепляете студента, отобразится ожидаемая заявка, на которую должен отреагировать сотрудник учебного заведения.

Через API вы можете оследить статус этой заявки. Для этого отправьте `GET` запрос на адрес `https://api.studgram.ru/api/students/{ID_СТУДЕНТА}/status`.  
После успешного выполнения запроса вы получите информацию о заявке в следующем формате.

```JSON
{
  "approved": false 
}
```

`false` - заявка всё ещё находится на рассмотрении администрации учебного заведения;
`true` - заявка одобрена администратором, студент имеет полный доступ к данным учебного заведения.

Обратите внимание, что вы можете получить ошибку с `404` статус-кодом, это означает, что студент не прикреплён ни к какой группе, и заявка не найдена.

### 3.10 Получние информации о факультете студента

Для получения текущего факультета студента нужно выполнить `GET` запрос на адрес `https://api.studgram.ru/api/students/{ID_СТУДЕНТА}/faculty`.  
Если студент прикрелпён к какому-либо факультету - вы получите информацию о нём в следующем формате:

```JSON
{
  "id": "Текстовый ID факультета",
  "abbreviation": "Аббревиатура названия факультета",
  "title": "Полное название факультета"
}
```

### 3.11 Получние информации о группе студента

Для получения текущей группы студента нужно выполнить `GET` запрос на адрес `https://api.studgram.ru/api/students/{ID_СТУДЕНТА}/group`.  
Если студент прикрелпён к какой-либо группе - вы получите информацию о ней в следующем формате:

```JSON
{
  "id": "Текстовый ID группы",
  "abbreviation": "Аббревиатура названия группы",
  "title": "Полное название группы"
}
```

### 3.12 Получение ID студента по его ID в мессенджере MAX, Telegram или ВКонтакте

Если при регистрации или обновлении студента вы указали ему поле `maxId`, то вы сможете получить ID студента в системе, выполнив `GET` запрос на `https://api.studgram.ru/api/students/max/{MAX_ID_СТУДЕНТА}`.

При успешном выполнении запроса вы получите ID студента в следующем формате:

```JSON
{
  "id": "3da75617-2073-494b-a80a-692235cda59d"
}
```

Обратите внимание, что это не полная информация о студенте, так вы можете получить только его ID в системе, с помощью которого вы сможете выполнять другие операции.

Вам так же доступны похожие методы для поиска студента по его ID во ВКонтакте или Telegram:  
`GET` - `https://api.studgram.ru/api/students/vk/{VK_ID_СТУДЕНТА}`.  
`GET` - `https://api.studgram.ru/api/students/telegram/{TELEGRAM_ID_СТУДЕНТА}`.  

## 4. Статус-коды

При работе с API вы можете получать следующие статус-коды:  
* `200` - Запрос выполнен успешно;
* `400` - Ошибка на вашей стороне при оформлении данных запроса или нарушение логики работы запроса;
* `401` - Ошибка при авторизации, возможно указан неверный API-токен;
* `403` - Недостаточно прав для выполнения запроса;
* `404` - Объект, к которому вы пытаетесь получить доступ, не существует;
* `405` - Неверный метод (`GET`, `POST`, `PATCH`, `DELETE`) или неверное содержимое запроса;
* `409` - Запрос невозможно выполнить, потому что это приводит к конфликту сущностей;
* `500` - Ошибка сервера, баг или недоработка кода API - обратитесь к разработчику.

## Дополнительно

Я оставлю здесь CURL-запрос, который точно работает и протестирован лично мной, чтобы вы могли с помощью него отладить какие-то проблемы с авторизацией или адресами запросов.

`curl --location 'https://api.studgram.ru/api/institutions' --header 'API-Token: 1762743321884_CF9866FA489E4411816F037FF1D62719'`

Я дополнительно отмечу, что это заведомо рабочий запрос, который должен у вас проходить без ошибок, если вы не удалили в панели администратора API-токен, который датируется 10.11.2025, 05:55:21.
